<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¨ªå•è€…æ’ƒé€€ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            overflow: hidden;
            text-align: center;
        }

        /* è­¦å‘Šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .alert-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.2);
            animation: blink 1s infinite;
            z-index: -1;
            display: none;
        }
        @keyframes blink { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }

        h1 { font-size: 1.2rem; color: #ff4444; }

        /* ã‚«ãƒ¡ãƒ©ã‚³ãƒ³ãƒ†ãƒŠ */
        #camera-container {
            width: 100%;
            height: 250px;
            background: #000;
            border: 2px solid #ff4444;
            margin-bottom: 20px;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
        }
        video { width: 100%; height: 100%; object-fit: cover; }
        .recording-dot {
            position: absolute;
            top: 10px; left: 10px;
            color: #ff4444;
            font-weight: bold;
            display: none;
        }

        /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º */
        #countdown {
            font-size: 5rem;
            font-weight: bold;
            color: #ff4444;
            margin: 10px 0;
            display: none;
        }

        /* ãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }

        .btn-emergency { background: #ff4444; color: white; }
        .btn-line { background: #06C755; color: white; display: none; }
        .btn-call { background: #4444ff; color: white; display: none; }
        
        #status-text { color: #aaa; font-size: 0.9rem; margin-top: 10px; }
    </style>
</head>
<body>

<div class="alert-bg" id="bg-alert"></div>

<h1>âš ï¸ é˜²çŠ¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ </h1>

<div id="camera-container">
    <div class="recording-dot" id="rec-label">â— REC / ã‚µãƒ¼ãƒãƒ¼è»¢é€ä¸­</div>
    <video id="video" autoplay playsinline muted></video>
</div>

<div id="countdown">10</div>

<button class="btn btn-emergency" id="start-btn" onclick="startEmergency()">ğŸš¨ è­¦å‘Šã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹</button>

<button class="btn btn-line" id="line-btn" onclick="sendSOS()">ğŸ“± å®¶æ—ã«LINEã§ä½ç½®é€ä¿¡</button>
<a href="tel:110" class="btn btn-call" id="call-btn">ğŸ“ 110ç•ªé€šå ±</a>

<p id="status-text">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è¨¼æ‹ è¨˜éŒ²ã¨é€šå ±æº–å‚™ã‚’é–‹å§‹ã—ã¾ã™</p>

<script>
    let count = 10;
    let timer;

    async function startEmergency() {
        // 1. ã‚«ãƒ¡ãƒ©èµ·å‹•
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }, audio: false });
            document.getElementById('video').srcObject = stream;
            document.getElementById('rec-label').style.display = 'block';
        } catch (err) {
            console.error("Camera error:", err);
        }

        // 2. æ¼”å‡ºé–‹å§‹
        document.getElementById('start-btn').style.display = 'none';
        document.getElementById('countdown').style.display = 'block';
        document.getElementById('bg-alert').style.display = 'block';
        
        // 3. éŸ³å£°è­¦å‘Š
        speak("ä¸å½“ãªå±…åº§ã‚Šã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚10ç§’å¾Œã«è‡ªå‹•é€šå ±ã¨ç¾åœ¨åœ°ã®é€ä¿¡ã‚’è¡Œã„ã¾ã™ã€‚ç›´ã¡ã«é€€å»ã—ã¦ãã ã•ã„ã€‚");

        // 4. ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
        timer = setInterval(() => {
            count--;
            document.getElementById('countdown').innerText = count;
            
            if (count <= 0) {
                clearInterval(timer);
                document.getElementById('countdown').innerText = "é€šå ±æº–å‚™å®Œäº†";
                document.getElementById('line-btn').style.display = 'block';
                document.getElementById('call-btn').style.display = 'block';
                speak("ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚é€šå ±ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚");
            }
        }, 1000);
    }

    function speak(text) {
        const uttr = new SpeechSynthesisUtterance(text);
        uttr.lang = "ja-JP";
        uttr.rate = 1.0;
        window.speechSynthesis.speak(uttr);
    }

    function sendSOS() {
        if (!navigator.geolocation) {
            alert("ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“");
            return;
        }

        navigator.geolocation.getCurrentPosition((position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const mapUrl = `https://www.google.com/maps?q=${lat},${lon}`;
            const message = `ã€ç·Šæ€¥SOSã€‘ä¸å¯©ãªè¨ªå•è€…ãŒã„ã¾ã™ï¼åŠ©ã‘ã¦ãã ã•ã„ã€‚ç¾åœ¨åœ°ï¼š${mapUrl}`;
            
            // LINE URLã‚¹ã‚­ãƒ¼ãƒ 
            const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(message)}`;
            window.location.href = lineUrl;
        }, () => {
            alert("ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿é€ä¿¡ã—ã¾ã™ã€‚");
            const message = "ã€ç·Šæ€¥SOSã€‘ä¸å¯©ãªè¨ªå•è€…ãŒã„ã¾ã™ï¼åŠ©ã‘ã¦ãã ã•ã„ï¼";
            window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(message)}`;
        });
    }
</script>

</body>
</html>
