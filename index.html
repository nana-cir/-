<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é˜²çŠ¯ãƒ»æ’ƒé€€ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        :root { --danger: #ff4444; --success: #06C755; --bg: #1a1a1a; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        
        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆ */
        .screen { display: none; }
        .active { display: block; }

        /* åˆ¤å®šç”»é¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card { background: #333; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; }
        select, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none; font-size: 1rem; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-item { background: #444; padding: 8px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }
        .checkbox-item.selected { background: var(--danger); }

        /* ç·Šæ€¥ç”»é¢ï¼ˆå¨åš‡ãƒ¢ãƒ¼ãƒ‰ï¼‰ */
        #emergency-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; padding: 20px; box-sizing: border-box; }
        .alert-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,0,0,0.2); animation: flash 1s infinite; pointer-events: none; }
        @keyframes flash { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }

        #video-container { width: 100%; height: 50vh; background: #222; border: 2px solid var(--danger); position: relative; overflow: hidden; border-radius: 10px; }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .rec-label { position: absolute; top: 10px; left: 10px; color: red; font-weight: bold; animation: flash 0.8s infinite; }

        /* ãƒ•ã‚§ã‚¤ã‚¯ãƒ­ã‚°ï¼ˆè©æ¬ºå¸«æ’ƒé€€ç”¨ï¼‰ */
        #log-display { background: rgba(0,0,0,0.8); color: #00ff00; font-family: monospace; font-size: 0.7rem; text-align: left; padding: 10px; height: 80px; overflow-y: hidden; border: 1px solid #333; margin-top: 10px; }

        #countdown { font-size: 4rem; font-weight: bold; color: var(--danger); margin: 10px 0; }

        /* ãƒœã‚¿ãƒ³ */
        .btn-red { background: var(--danger); color: white; font-weight: bold; }
        .btn-green { background: var(--success); color: white; font-weight: bold; }
        .btn-blue { background: #4444ff; color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div id="main-screen" class="screen active">
        <h1>è¨ªå•è€…ãƒã‚§ãƒƒã‚¯</h1>
        <div class="card">
            <label>â–¼ è¨ªå•è€…ã¯ã©ã‚“ãªäººï¼Ÿ</label>
            <select id="visitor-type">
                <option value="none">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="sales">å–¶æ¥­ãƒ»ã‚»ãƒ¼ãƒ«ã‚¹é¢¨</option>
                <option value="worker">ä½œæ¥­ç€ãƒ»ç‚¹æ¤œå“¡</option>
                <option value="official">å½¹æ‰€ãƒ»è­¦å¯Ÿãƒ»å…¬å…±æ©Ÿé–¢</option>
                <option value="delivery">å®…é…ãƒ»éƒµä¾¿</option>
                <option value="other">ãã®ä»–ï¼ˆç§æœãƒ»ä¸æ˜ï¼‰</option>
            </select>
        </div>

        <div class="card">
            <label>â–¼ è¨€ã‚ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆè¤‡æ•°é¸æŠï¼‰</label>
            <div class="checkbox-group" id="keyword-group">
                <div class="checkbox-item" onclick="toggleTag(this)" data-val="free">ç„¡æ–™ç‚¹æ¤œ</div>
                <div class="checkbox-item" onclick="toggleTag(this)" data-val="buy">è²·ã„å–ã‚Š</div>
                <div class="checkbox-item" onclick="toggleTag(this)" data-val="now">ä»Šæ—¥ã ã‘/ä»Šã™ã</div>
                <div class="checkbox-item" onclick="toggleTag(this)" data-val="card">ã‚«ãƒ¼ãƒ‰/æš—è¨¼ç•ªå·</div>
                <div class="checkbox-item" onclick="toggleTag(this)" data-val="door">ãƒ‰ã‚¢é–‹ã‘ã¦</div>
            </div>
        </div>

        <button class="btn-red" onclick="startEmergency()" style="font-size: 1.2rem; padding: 20px;">ğŸš¨ ã™ã§ã«å®¶ã®ä¸­ã«ã„ã‚‹ / ç·Šæ€¥</button>
        <p style="color: #888; font-size: 0.8rem;">â€»ç·Šæ€¥ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å³åº§ã«è­¦å‘Šãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚Šã¾ã™</p>
    </div>

    <div id="emergency-screen" class="screen">
        <div class="alert-flash"></div>
        <div id="video-container">
            <div class="rec-label">â— RECORDING / CLOUD UPLOADING</div>
            <video id="video" autoplay playsinline muted></video>
        </div>
        
        <div id="log-display"></div>
        <div id="countdown">10</div>

        <div id="emergency-actions" style="display: none;">
            <button class="btn-green" onclick="sendSOS()">ğŸ“± å®¶æ—ã«LINEé€ä¿¡</button>
            <a href="tel:110" class="btn-blue" style="display:block; text-decoration:none; padding:12px; border-radius:5px;">ğŸ“ 110ç•ªé€šå ±</a>
            <button onclick="location.reload()" style="background:none; color:#555; font-size:0.7rem;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <script>
        // ã‚¿ã‚°é¸æŠã®åˆ¶å¾¡
        function toggleTag(el) {
            el.classList.toggle('selected');
        }

        // ãƒ•ã‚§ã‚¤ã‚¯ãƒ­ã‚°ã®è¿½åŠ 
        function addLog(text) {
            const logBox = document.getElementById('log-display');
            const p = document.createElement('div');
            p.textContent = `> ${text}`;
            logBox.appendChild(p);
            logBox.scrollTop = logBox.scrollHeight;
        }

        // éŸ³å£°èª­ã¿ä¸Šã’
        function speak(text) {
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            window.speechSynthesis.speak(uttr);
        }

        // ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰èµ·å‹•
        async function startEmergency() {
            document.getElementById('main-screen').classList.remove('active');
            document.getElementById('emergency-screen').classList.add('active');

            // ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆã‚¤ãƒ³ã‚«ãƒ¡ï¼‰
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('video').srcObject = stream;
            } catch (err) {
                addLog("ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ã€‚è¨¼æ‹ ä¿å­˜ãƒ¢ãƒ¼ãƒ‰ã§ç¶™ç¶š...");
            }

            // ãƒ•ã‚§ã‚¤ã‚¯ãƒ­ã‚°é–‹å§‹ï¼ˆæ‚ªãƒãƒªæ¼”å‡ºï¼‰
            addLog("åºƒåŸŸé˜²çŠ¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«æ¥ç¶šä¸­...");
            setTimeout(() => addLog("ç”»åƒè§£æï¼šä¸å¯©è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç…§åˆé–‹å§‹"), 1000);
            setTimeout(() => addLog("GPSè£œè¶³ï¼šç¾åœ¨åœ°ã‚’ç®¡è½„ç½²ã¸å…±æœ‰ä¸­"), 3000);
            setTimeout(() => addLog("è¨¼æ‹ å‹•ç”»ã‚’æš—å·åŒ–ã—ã¦ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜ä¸­..."), 5000);

            // éŸ³å£°è­¦å‘Š
            speak("ä¸å½“ãªå±…åº§ã‚Šã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚10ç§’å¾Œã«è‡ªå‹•é€šå ±ã‚’è¡Œã„ã¾ã™ã€‚ç›´ã¡ã«é€€å»ã—ã¦ãã ã•ã„ã€‚");

            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
            let count = 10;
            const timer = setInterval(() => {
                count--;
                document.getElementById('countdown').innerText = count;
                if (count <= 0) {
                    clearInterval(timer);
                    document.getElementById('countdown').style.display = 'none';
                    document.getElementById('emergency-actions').style.display = 'block';
                    addLog("é€šå ±å¾…æ©ŸçŠ¶æ…‹ã€‚å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚");
                    speak("ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒçµ‚äº†ã—ã¾ã—ãŸã€‚è­¦å¯Ÿã¸é€šå ±ã—ã¾ã™ã‹ï¼Ÿ");
                }
            }, 1000);
        }

        // LINE SOSé€ä¿¡
        function sendSOS() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    const mapUrl = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                    const msg = `ã€ç·Šæ€¥SOSã€‘è¨ªå•è€…ãŒå®¶ã‹ã‚‰å¸°ã‚Šã¾ã›ã‚“ï¼åŠ©ã‘ã¦ï¼ç¾åœ¨åœ°:${mapUrl}`;
                    window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
                }, (err) => {
                    const msg = `ã€ç·Šæ€¥SOSã€‘è¨ªå•è€…ãŒå®¶ã‹ã‚‰å¸°ã‚Šã¾ã›ã‚“ï¼åŠ©ã‘ã¦ï¼(ä½ç½®æƒ…å ±å–å¾—å¤±æ•—)`;
                    window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
                });
            }
        }
    </script>
</body>
</html>
